---
layout: post
title: Node.js | Crypto JS
category: Node.js
tags: [node.js]
comments: true
---

#### <center>" λ°μ΄ν„°λ² μ΄μ¤μ— λΉ„λ°€λ²νΈλ¥Ό μλ” κ·Έλ€λ΅ μ €μ¥ν•λ‹¤λ©΄,<br>κ·Έκ²ƒμ€ ν•΄μ»¤μ—κ² μ—΄λ¦° λ¬Έμ΄ μ–΄λ””μΈμ§€ μ•λ ¤μ¤€κ±°λ‚ λ‹¤λ¦„μ—†λ‹¤.<br>λ¬Όλ΅  λ°μ΄ν„°λ² μ΄μ¤κ°€ ν•΄ν‚Ή λ‹Ήν•μ§€ μ•λ”κ² μµμ„ μ΄μ§€λ§,<br>μµμ†ν•μ μ•μ „μ¥μΉλ΅ λΉ„λ°€λ²νΈλ¥Ό μ•”νΈν™” ν•λ”κ²ƒμ€ κ°λ°μμ μλ¬΄μΈκ²ƒ κ°™λ‹¤. "</center>

---

## λ‹¨λ°©ν–¥ μ•”νΈν™” Β vs Β μ–‘λ°©ν–¥ μ•”νΈν™”

**`λ‹¨λ°©ν–¥ μ•”νΈν™”`**Β : μ•”νΈν™” O λ³µνΈν™” β (μ›λ λΉ„λ°€λ²νΈ μ• μ μ—†μ)

**`μ–‘λ°©ν–¥ μ•”νΈν™”`**Β : μ•”νΈν™” O λ³µνΈν™” O (μ›λ λΉ„λ°€λ²νΈ μ• μ μμ)

> λ³µνΈν™” : μ•”νΈν™”λ λ¬Έμμ—΄μ„ μ•”νΈν™” λκΈ°μ „μ— ν‰λ¬ΈμΌλ΅ λλλ ¤ λ†“λ” κ²ƒ

<br>
κ²½ν—μƒ λ€λ¶€λ¶„ μ‚¬μ΄νΈμ—μ„ λΉ„λ°€λ²νΈλ¥Ό μ°Ύμ„ λ•, μ›λ λΉ„λ°€λ²νΈλ¥Ό μ•λ ¤μ£Όλ” κ²ƒμ΄ μ•„λ‹ μ¬μ„¤μ •μ„ ν–μ„ κ²ƒμ΄λ‹¤.   
μ΄λ ‡λ“― λΉ„λ°€λ²νΈλ” λ³΄ν†µΒ **λ‹¨λ°©ν–¥ μ•”νΈν™”**λ¥Ό λ§μ΄ μ‚¬μ©ν•λ‹¤. κµ³μ΄ λΉ„λ°€λ²νΈλ¥Ό λ³µνΈν™”ν•  ν•„μ”κ°€ μ—†κΈ° λ•λ¬Έμ΄λ‹¤.

κΈ°μ΅΄ λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥λ μ•”νΈν™”λ λΉ„λ°€λ²νΈμ™€ λ΅κ·ΈμΈμ‹ μ…λ ¥ν• λΉ„λ°€λ²νΈλ¥Ό λ‹¨λ°©ν–¥ μ•”νΈν™”λ¥Ό ν•΄μ„ λΉ„κµν•λ©΄ λλ‹¤.

μ¦‰ κΈ°μ΅΄μ λΉ„λ°€λ²νΈλ” μ–΄λ””μ—λ„ μ €μ¥λμ§€ μ•κ³  <u>μ•”νΈν™” λ λ¬Έμμ—΄λ΅λ§</u> λΉ„κµν•λ” κ²ƒμ΄λ‹¤.

<br>
**λ‹¨λ°©ν–¥ μ•”νΈν™”**λ”Β **`Hash μ•κ³ λ¦¬μ¦`**μ„ μ‚¬μ©ν•λ”λ°,

**`Hash(ν•΄μ‹ ν•¨μ)`**λ” μ„μμ ν¬κΈ°λ¥Ό κ°€μ§„ λ¬Έμμ—΄μ„ κ³ μ •λ κΈΈμ΄μ λ‹¤λ¥Έ λ¬Έμμ—΄(**digest**Β ν•νƒ)λ΅ λ³€κ²½ν•λ”κ²ƒμ„ λ§ν•λ‹¤.

μ—¬κΈ°μ„Β **digest**λ€,Β **`ν•΄μ‹ν•¨μ`**λ¥Ό ν†µν•΄ μƒμ„±λΒ **μ•”νΈν™”λ λ©”μ‹μ§€**μ΄λ‹¤

μλ¥Ό λ“¤μ–΄Β λΉ„λ°€λ²νΈκ°€ 123, 123456μΌλ΅ κΈΈμ΄κ°€ λ‹¬λΌλ„Β **`Hash μ•κ³ λ¦¬μ¦`**μ—μ„ κΈΈμ΄λ¥Ό 5λ΅ μ„¤μ •ν–λ‹¤λ©΄ λΉ„λ°€λ²νΈλ” abcR1, JK4qlμ²λΌ 5κΈ€μλ΅ λ³€κ²½λλ‹¤.

> κ·Έ μ™Έ Hash νΉμ§•

- **μΌλ°©ν–¥μ„±**Β :Β νΉμ •Β ν•΄μ‰¬λ¥ΌΒ μƒμ„±ν•κΈ° μ„ν• κ°’μ„ μ°Ύλ” κ²ƒμ€ λ¶κ°€λ¥ν•λ‹¤. (μ—­μ‚°μ΄ λ¶κ°€)
- **μ¶©λ νν”Όμ„±**Β : λ™μΌν• λ‘κ°μ Hashλ¥Ό λ§λ“¤μ–΄λ‚΄λ” κ²ƒμ€ λ¶κ°€λ¥ν•λ‹¤.

---

## Crypto JS

**β–¶ μλ°”μ¤ν¬λ¦½νΈμ—μ„ Secure Hash Algorithm(SHA) λ“± μ—¬λ¬Β [μ•”νΈν™” μ•κ³ λ¦¬μ¦](https://mojaeya.tistory.com/53?category=490158)μ„ μ‚¬μ©ν•  μ μκ² ν•΄μ£Όλ” λ¨λ“**

#### Crypto JS ν•„μ”μ„±

- javascriptλ¥Ό μ΄μ©ν• μ„λΉ„μ¤μ—μ„, μ—¬λ¬κ°€μ§€ μ •λ³΄(ex : λΉ„λ°€λ²νΈ)λ¥Ό μ•μ „ν•κ² μ•”νΈν™” ν•  μ μλ‹¤

#### Crypto JS μ„¤μΉ

- npmΒ install --save crypto-js

---

## Crypto JSλ¥Ό ν™μ©ν• λ‹¨λ°©ν–¥ μ•”νΈν™”

#### [ λ‹¨μν•κ²Β `Hash`λ§ μ‚¬μ©ν•΄μ„ μ•”νΈν™”λ¥Ό ν•λ©΄ μ λ€ μ•λλ‹¤ ]

```javascript
const crypto = require("crypto");

crypto.createHash("sha512").update("λΉ„λ°€λ²νΈ").digest("base64"); // 'dvfV6nyLRRt3NxK ...'

crypto.createHash("sha512").update("λΉ„λ°€λ²νΈ").digest("base64"); // μ„μ™€ κ°™μ€ κ²°κ³Ό

crypto.createHash("sha512").update("λΉ„λ°€λ²νΈ").digest("hex"); // '76f7d5ea7c8b451b7 ...'
```

μ΄λ ‡κ² crypto λ¨λ“ λ¶λ¬μ™€μ„ createHash λ©”μ†λ“ μ‚¬μ©ν•λ©΄ κ°€μ¥ κ°„λ‹¨ν• λ‹¨λ°©ν–¥ μ•”νΈν™” λ°©μ‹μ΄λ‹¤.

**`CreateHash λ©”μ†λ“`**μ— μΈμλ΅ μ‚¬μ©ν•  μ•κ³ λ¦¬μ¦( sha512 )λ„£μ–΄μ£Όκ³ Β **`update`**Β μ—λ” μ•”νΈν™”ν•  λΉ„λ°€λ²νΈ, Β **`digest`**Β μ—λ” μ–΄λ–¤ μΈμ½”λ”© λ°©μ‹μΌλ΅ μ•”νΈν™”λ λ¬Έμμ—΄μ„ ν‘μ‹ν• μ§€ μ •ν•΄μ¤€λ‹¤. Β μ—¬κΈ°μ„ base64λ€, 8λΉ„νΈ μ΄μ§„ λ°μ΄ν„°λ¥Ό ASCII μμ—­μ λ¬Έμμ—΄λ΅ λ°”κΎΈλ” μΈμ½”λ”© λ°©μ‹μ΄λ‹¤.

ν•μ§€λ§ λ³΄μ΄λ” κ²ƒμ²λΌ κ°™μ€ μ•κ³ λ¦¬μ¦κ³Ό κ°™μ€ μΈμ½”λ”© λ°©μ‹μ„ μ‚¬μ©ν•λ©΄ λ§¤λ² κ°™μ€ λΉ„λ°€λ²νΈμ— λ€ν•΄ κ°™μ€ κ²°κ³Όλ¥Ό λ°ν™ν•λ‹¤λ” κ²ƒμ„ μ• μ μλ‹¤.

κ·Έλμ„ λΉ„λ°€λ²νΈ μ•”νΈν™”μ— μ‚¬μ©ν•  μ μλ”κ²ƒμΈλ°, <u>λ°λ€λ΅ μ΄κ²ƒμ΄ ν•΄μ»¤λ“¤μ—κ² λΉ„λ°€λ²νΈλ¥Ό μ μ¶”ν•΄λ‚΄κ² ν•λ” λΉλ―Έ</u>κ°€ λμ–΄λ²„λ¦΄ μλ„ μλ‹¤λ”κ±°λ‹¤. μ΄λ¬ν• λ°μ΄ν„°λ² μ΄μ¤λ¥Ό `λ μΈλ³΄μ° ν…μ΄λΈ”`μ΄λΌκ³  ν•λ‹¤.

λ”°λΌμ„, ν•΄μ»¤κ°€ `λ μΈλ³΄μ° ν…μ΄λΈ”`μ„ μ‚¬μ© λ»ν•κ² ν•λ” λ°©λ²•μ΄ ν•„μ”ν•λ‹¤! (μ•„μ λ»ν•κ² λ»ν•κ³ , μ •λ§ μ •λ§ μ¤λκ±Έλ¦¬κ²~)

#### λ³΄μ™„ λ°©λ²• : `salt` μ¦‰, μ†κΈμ„ λΏλ ¤μ£Όλ©΄ λλ‹¤.

λΉ„λ°€λ²νΈμ— saltλΌλ” νΉμ • λ¬Έμμ—΄μ„ λ¶™μ—¬μ„ κ·Έκ²ƒμ„ μ λ§λ² λ°λ³µΒ **`ν•΄μ‹ν™”`**Β ν•λ” κ±°λ‹¤.Β **`salt`**λ” λλ¤ λ¬Έμμ—΄μ„ μƒμ„±ν•΄μ„ λΉ„λ°€λ²νΈμ™€ κ°™μ΄ λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥ν•λ©΄ λλ‹¤.

#### [Β `salt`Β λ¥Ό ν™μ©ν• Β μ•”νΈν™” λ° λ΅κ·ΈμΈν•  λ• λΉ„κµν•λ” μ•”νΈ ν™•μΈ ν•¨μ ]

```javascript
const crypto = require("crypto");

// 1. νμ›κ°€μ…μ‹ μ…λ ¥ν• λΉ„λ°€λ²νΈ + salt μƒμ„± => μ•”νΈν™” ν•¨μ
module.exports.createPasswordPbkdf2 = (pw) => {
  const salt = crypto.randomBytes(32).toString("base64");
  const encodedPw = crypto
    .pbkdf2Sync(pw, salt, 99381, 32, "sha512")
    .toString("base64");
  // λ³€μ μλ―Έ : μ•”νΈ, μ•”νΈμ κΈ°μ¤€μ΄ λλ”ν‚¤, ν•΄μ‰¬λ¥Ό μ§„ν–‰ν•λ” λ°λ³µ νμ, λ°μ΄ν„° κΈΈμ΄, ν•΄μ‹ κ°’
  // sha512λ” 512λΉ„νΈ(64λ°”μ΄νΈ) ν•΄μ‹ κ°’μ„ μƒμ„±
  return { encodedPw, salt }; // μ•”νΈν™”λ λΉ„λ°€λ²νΈ, salt λ°ν™
};

// 2. λ΅κ·ΈμΈμ‹ μ…λ ¥ν• λΉ„λ°€λ²νΈ + dbμ— μ €μ¥λ salt -> μ•”νΈν™” ν•¨μ
module.exports.getPasswordPbkdf2 = (pw, salt) => {
  return crypto.pbkdf2Sync(pw, salt, 99381, 32, "sha512").toString("base64");
  // sha512λ” 512λΉ„νΈ(64λ°”μ΄νΈ) ν•΄μ‹ κ°’μ„ μƒμ„±
};
```

#### π“ Β 1. νμ›κ°€μ…μ‹Β μ…λ ¥ν•Β λΉ„λ°€λ²νΈΒ +Β saltΒ μƒμ„± Β => Β μ•”νΈν™”Β ν•¨μ : β†

randomBytes λ©”μ†λ“λ¥Ό ν†µν•΄Β **salt**μ—Β μ‚¬μ©ν•  μ„μμ 32Byteμ§λ¦¬ κ°’μ„ ν•λ‚ λ§λ“¤μ–΄μ¤€λ‹¤.

λ§λ“¤μ–΄μ§„ κ°’μ€ byteκ°’μ΄μ§€λ§ μ‚¬μ©μκ°€ μ‘μ„±ν• κ°’κ³Ό μ—°κ²°λμ–΄ μ•”νΈν™”λκΈ° λ•λ¬Έμ—Β **salt**λ¥Ό μ‚¬μ©μ μ•”νΈμ™€ κ°™μ€ ν•νƒ( base64 )μ λ¬Έμμ—΄λ΅ λ³€ν™μ‹μΌ μ¤€λ‹¤.

**β“ `PBKDF2(Password-Based Key Derivation Function)`**  
**`ν•΄μ‹ν•¨μ`**μ μ»¨ν…μ΄λ„μΈΒ **`PBKDF2`**λ”Β **`salt`**λ¥Ό μ μ©ν• ν›„ ν•΄μ‹ν•¨μμ λ°λ³µ νμλ¥Ό μ„μλ΅ μ„ νƒν•  μ μλ‹¤.

**`PBKDF2`**λ” μ•„μ£Ό κ°€λ³κ³  κµ¬ν„ν•κΈ° μ‰¬μ°λ©°,Β **`SHA`**μ™€ κ°™μ΄ κ²€μ¦λΒ **`ν•΄μ‹ν•¨μ`**λ§μ„ μ‚¬μ©ν•λ‹¤.

#### μ„μ— μ½”λ“μ—μ„ `pbkdf2Sync` λ³€μλ” λ‹¤μκ³Ό κ°™λ‹¤.

λ³€μ μλ―Έ : pw=μ•”νΈ, salt=μ•”νΈμΒ κΈ°μ¤€μ΄Β λλ”ν‚¤, 99381=ν•΄μ‰¬λ¥ΌΒ μ§„ν–‰ν•λ”Β λ°λ³µΒ νμ(ν‚¤ μ¤νΈλ μΉ­), 32=λ°μ΄ν„°Β κΈΈμ΄, sha512(ν•΄μ‹± μ•κ³ λ¦¬μ¦)=ν•΄μ‹ κ°’

#### π“ 2. λ΅κ·ΈμΈμ‹Β μ…λ ¥ν•Β λΉ„λ°€λ²νΈΒ +Β dbμ—Β μ €μ¥λΒ salt Β => Β μ•”νΈν™”Β ν•¨μ Β : Β β…

#### μ μ €κ°€ νμ›κ°€μ…μ„ ν•κ³  λ΅κ·ΈμΈκΉμ§€μ λΉ„λ°€λ²νΈ μ•”νΈν™” λΉ„κµ κ³Όμ • ( λ³„ν‘μ‹κ°€ μ„μ— μ½”λ“ ν•΄λ‹Ή λ¶€λ¶„)

1.  μ μ €κ°€ νμ›κ°€μ… ν†µν•΄ λΉ„λ°€λ²νΈ μƒμ„±
2.  λΉ„λ°€λ²νΈ+salt => μ•”νΈν™”(encodedPw)ν•΄μ„ DBμ— μ €μ¥ (salt Β λ”°λ΅ ν¬ν•¨)Β **β†**
3.  μ μ €κ°€ λ΅κ·ΈμΈμ„ ν•λ©΄ DBμ—μ„ μ•”νΈν™”λ λΉ„λ°€λ²νΈμ™€ saltλ¥Ό μ½μ–΄μ΄
4.  λ΅κ·ΈμΈμ‹ μ…λ ¥ν• λΉ„λ°€λ²νΈ+salt(2λ²μ—μ„ DBμ— μ €μ¥λ) => μ•”νΈν™”Β **β…**
5.  DBμ—μ„ λ¶λ¬μ¨ μ•”νΈν™” λΉ„λ°€λ²νΈμ™€ 4λ² κ°’μ΄ μΌμΉν• μ§€ λΉ„κµ

<br>
**μ¦‰, νμ›κ°€μ…μ—μ„λ” saltλ¥Ό λλ¤ λ¬Έμμ—΄λ΅ λ§λ“¤κ³ , λ΅κ·ΈμΈμ—μ„λ” νμ›κ°€μ…μ—μ„ λ§λ“¤μ–΄μ§„ saltλ¥Ό κ°€μ Έμ™€μ„ ν•΄μ‹±ν•λ” κ²ƒμ΄λ‹¤.**

**<font color="red">μ£Όμ</font> β—οΈ μ•”νΈν™” λ°©μ‹μ΄ λ‘κ°™κΈ° λ•λ¬Έμ— ν‚¤ μ¤νΈλ μΉ­μ΄λ‚ ν•΄μ‹± μ•κ³ λ¦¬μ¦μ΄ μ„λ΅ λ‹¤λ¥΄λ©΄ μ•λλ‹¤!!!**

<br>
[**μ°Έκ³ ν•΄λ³΄λ©΄ μΆ‹μ„ ν¬μ¤ν…**](https://d2.naver.com/helloworld/318732)

<br>
<br>
<br>

> **Reference**  
> λ³Έ ν¬μ¤ν…μ€ μ•„λ μ‚¬μ΄νΈλ¥Ό μ°Έμ΅° λ° μΈμ©ν•μ—¬ κ°μΈκ³µλ¶€ μ©λ„λ΅ μ‘μ„±λμ—μµλ‹λ‹¤.  
> μλ»λ λ‚΄μ© ν”Όλ“λ°± μ£Όμ‹λ©΄ λ°μν•κ² μµλ‹λ‹¤. κ°μ‚¬ν•©λ‹λ‹¤.  
> [https://zinirun.github.io/2020/12/02/node-crypto-password/](https://zinirun.github.io/2020/12/02/node-crypto-password/)  
> [https://www.zerocho.com/category/NodeJS/post/593a487c2ed1da0018cff95d](https://www.zerocho.com/category/NodeJS/post/593a487c2ed1da0018cff95d)  
> [https://velog.io/@nameunzz/λ‹¨λ°©ν–¥-ν•΄μ‹-ν•¨μ](https://velog.io/@nameunzz/λ‹¨λ°©ν–¥-ν•΄μ‹-ν•¨μ)  
> [https://jungeunpyun.tistory.com/26?category=911250](https://jungeunpyun.tistory.com/26?category=911250)
